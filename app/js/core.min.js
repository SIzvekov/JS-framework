function include(e,t,r,n,o){o||(o="div"),htmlBlock="<"+o.replace(">","").replace("<","")+" id='"+r+"'>",$(t).append(htmlBlock),$("#"+r).load(e,function(){renderAjaxLinks(),"function"==typeof n&&n()})}function replace(e,t,r,n,o){$(t).html(""),include(e,t,r,n,o)}function getHashUrl(){var e="";return isHashUrlMarker=window.location.hash.substr(1,1),"!"==isHashUrlMarker&&(e=window.location.hash.substr(2),e=e.split("?"),e=e[0]),e}function loadpage(e,t,r){if(!e)var e=window.location.pathname;if(!t)var t=getUrlParameterString();if(e=trimChar(e,"/"),e=e.replace(".html",""),!e)var e="index";return lastUrl==e&&lastParams==t?!1:(lastUrl=e,lastParams=getUrlParameterString(),r||(r="GET"),void $.ajax({url:"template/html/pages/"+e+"--v"+bodyCurentVersion+".html",type:r,data:t,beforeSend:function(){"function"==typeof before_page_load&&before_page_load(),document.title="",$(bodyContentIdentifyer).html(""),$("#loginForm").length&&$("#loginForm").remove(),$("body").append('<div class="bodyLoadSpinner"><i class="fa fa-'+bodyLoadSpinnerType+' fa-spin"></i></div>')},success:function(t){lines=t.split("\n"),"<!DOCTYPE html>"==lines[0]?include("template/html/html-errors/404.html",bodyContentIdentifyer,"bodyContent",function(){$(".bodyLoadSpinner").remove()}):$.getScript("template/js/pages/"+e+".js").complete(function(e,r){"success"==r&&"function"==typeof initPage?initPage(t):($(bodyContentIdentifyer).html(t),$(".bodyLoadSpinner").remove())}),"function"==typeof on_page_load&&on_page_load()},complete:function(){renderAjaxLinks()},error:function(e){include("template/html/html-errors/"+e.status+".html",bodyContentIdentifyer,"bodyContent",function(){$(".bodyLoadSpinner").remove()})}}))}function setPageAccessLevel(e){return e?(currentUserType=userType(),e=e.split(","),!currentUserType||"root"!=currentUserType&&-1==$.inArray(currentUserType,e)?($.cookie("loginUserTypeRequired",e),include("template/html/include/loginform.html","body","loginForm"),!1):(checkAuth(),auth_check_timer&&clearInterval(auth_check_timer),auth_check_timer=setInterval(checkAuth,checkAuthTimeout),void 0)):!0}function checkAuth(e){var t=userToken(),r=userType();data={type:r,token:t,_:getNocacheIndex()},API_query("auth",data,"GET",function(t){200!=t.code?$("#loginForm").length||(clearInterval(auth_check_timer),include("template/html/include/loginform.html","body","loginForm")):(saveAuthUserInfo(t),"function"==typeof e&&e())})}function userToken(){return $.cookie("userToken")}function userType(){return $.cookie("userType")}function authUserInfo(){return $.cookie("authUserInfo")}function saveUserToken(e){return $.cookie("userToken",e)}function saveUserType(e){return $.cookie("userType",e)}function saveAuthUserInfo(e){return $.cookie("authUserInfo",e)}function trimChar(e,t){for(;e.charAt(0)==t;)e=e.substring(1);for(;e.charAt(e.length-1)==t;)e=e.substring(0,e.length-1);return e}function getUrlParameterString(){var e="";return isHashUrlMarker=window.location.hash.substr(1,1),"!"==isHashUrlMarker&&(url=window.location.hash.substr(2),url&&(url=url.split("?"),url[1]&&(e=url[1]+="&"))),e+=window.location.search.substring(1)}function getUrlParameter(e){if(sPageURL=getUrlParameterString(),sPageURL)for(var t=sPageURL.split("&"),r=0;r<t.length;r++){var n=t[r].split("=");return n[0]==e?n[1]:null}}function mustacheRender(e,t){t||(t=bodyContentIdentifyer),$(t).html(Mustache.render($(t).html(),e))}function renderAjaxLinks(){$.each($("a.ajax-link"),function(){currentHref=$(this).attr("href"),"#!"!=currentHref.substr(0,2)&&(currentHref=trimChar(currentHref,"/"),currentHref=currentHref.replace(".html",""),$(this).attr("href","#!"+currentHref))})}function getNocacheIndex(){return Math.random().toString().replace("0.","")}function userLogOut(){var e=userToken(),t=userType();data={type:t,token:e,_method:"delete",_:getNocacheIndex()},API_query("auth",data,"GET",function(e){200!=e.code||checkAuth()})}function API_query(e,t,r,n){if(e=trimChar(e,"/"),r||(r="GET"),!e)return!1;t||(t=[]);var o="";!t.token&&userToken()&&(o="?token="+userToken());var a=r;$.ajax({type:a,url:APIurl+"/"+e+"/"+o,data:t,dataType:"JSON",beforeSend:function(){},complete:function(e){e=JSON.parse(e.responseText),n&&n(e)}})}$(function(){$.getScript("app/config.js").complete(function(e,t){"success"==t?($.each(cssFiles,function(e,t){$("head").append($('<link rel="stylesheet" type="text/css" />').attr("href","template/css/"+t+"--v"+bodyCurentVersion+".css"))}),include("template/html/index.html","body","body",function(){setInterval(function(){loadpage(getHashUrl())},100)})):document.write("Fatal ERROR: config file was not found.")})});var lastUrl="",lastParams="",auth_check_timer;